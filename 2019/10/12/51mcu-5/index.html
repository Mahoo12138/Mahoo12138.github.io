<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>51单片机学习之中断系统 [ Mahoo12138 ]</title><link rel="stylesheet" href="/css/index.css"><meta name="post"><link rel="stylesheet" href="/css/layouts/post.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="hexo-container"><header></header><main id="content"><article id="post"><h1>51单片机学习之中断系统</h1><h2 id="概念基础"><a href="#概念基础" class="headerlink" title="概念基础"></a>概念基础</h2><h3 id="什么是中断"><a href="#什么是中断" class="headerlink" title="什么是中断"></a><strong><font size=5>什么是中断</font></strong></h3><p>当你正在看动漫时，突然手机来电话了，你暂停动漫，去接电话，在接电话的时候，又有人敲门，你暂时放下电话，去开门。我们可以把看动漫当作在执行主程序，那么电话就是<strong>中断源</strong>，电话铃响了就是<strong>中断请求</strong>，暂停动漫即是<strong>现场保护</strong>，接电话就是<strong>中断响应</strong>，有敲门声就是<strong>更高一级的中断请求</strong>，去开门则是<strong>中断嵌套</strong>，把门打开继续接电话就是<strong>中断返回</strong>，电话OK后继续看动漫则是<strong>现场恢复</strong>。</p>
<p>内核与外设之间的主要交互方式有两种<font color="red">轮询</font>和<font color="red">中断</font>，轮询工作效率极低，而且不具有响应紧急事件的功能；<u>中断系统则使内核具备了应对突发事件的能力。</u></p>
<p>中断既然可以处理紧急事件，也就是不知道中断什么时候发生，所以每个中断都需要一个中断入口地址，即为<strong>中断向量</strong>，这样的话，无论中断什么时候发生，它都有一个确定的程序执行初始点。中断响应之后，执行的那段程序称之为<strong>中断服务函数</strong>，顾名思义它是专门为这个中断服务的。</p>
<h3 id="51单片机的中断系统"><a href="#51单片机的中断系统" class="headerlink" title="51单片机的中断系统 "></a><font size=5><strong>51单片机的中断系统</strong> </font></h3><p>80C51的中断系统有5个中断源 （忽略定时&#x2F;计数器2） ，2个优先级，可实现二级中断嵌套。</p>
<table>
<thead>
<tr>
<th align="center">中断源</th>
<th align="center">中断标志</th>
<th align="center">中断向量（地址）</th>
<th align="center">优先级</th>
<th align="center">序号（C语言）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">外部中断0 INT0</td>
<td align="center">IE0</td>
<td align="center">0003H</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">定时&#x2F;计数器0 T0</td>
<td align="center">TF0</td>
<td align="center">000BH</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">外部中断1 INT1</td>
<td align="center">IE1</td>
<td align="center">0013H</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">定时&#x2F;计数器1 T1</td>
<td align="center">TF1</td>
<td align="center">001BH</td>
<td align="center">4</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">串口中断</td>
<td align="center">RI&#x2F;TI</td>
<td align="center">0023H</td>
<td align="center">5</td>
<td align="center">4</td>
</tr>
</tbody></table>
<p> <img src="https://cdn.jsdelivr.net/gh/mahoo12138/js-css-cdn/hexo-images/study/51mcu/51%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F.jpg" alt="中断系统结构"> </p>
<p>从前面的介绍我们可以知道，不管主程序执行到什么地方，只要外部中断0产生请求，内核就要响应该中断，就回到0003H这个地址去执行代码。如果使用汇编语言，则要记住每个中断源对应的地址；C语言则需要记住序号即可。</p>
<h3 id="中断控制"><a href="#中断控制" class="headerlink" title="中断控制"></a><strong><font size=5>中断控制</font></strong></h3><p>4个特殊功能寄存器来实施中断控制：</p>
<ul>
<li>中断允许寄存器 IE (Interrupt Enable )</li>
<li>中断优先级寄存器 IP ( Interrupt Priority )</li>
<li>定时&#x2F;计数器及外部中断控制寄存器 TCON</li>
<li>串口控制寄存器 SCON</li>
</ul>
<p><strong><font size = 4>中断响应条件：</font></strong></p>
<ul>
<li>中断源有中断请求</li>
<li>此中断源的中断允许位为1</li>
<li>CPU中断允许位为1</li>
</ul>
<h4 id="中断允许寄存器-IE"><a href="#中断允许寄存器-IE" class="headerlink" title="中断允许寄存器 IE"></a>中断允许寄存器 IE</h4><table>
<thead>
<tr>
<th align="center">位序</th>
<th align="center">7</th>
<th align="center">6</th>
<th align="center">5</th>
<th align="center">4</th>
<th align="center">3</th>
<th align="center">2</th>
<th align="center">1</th>
<th align="center">0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">名称</td>
<td align="center">EA</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">ES</td>
<td align="center">ET1</td>
<td align="center">EX1</td>
<td align="center">ET0</td>
<td align="center">EX0</td>
</tr>
<tr>
<td align="center">控制位（0禁止，1允许）</td>
<td align="center">总开关</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">串口</td>
<td align="center">定时器1</td>
<td align="center">外部中断1</td>
<td align="center">定时器0</td>
<td align="center">外部中断0</td>
</tr>
<tr>
<td align="center">位地址</td>
<td align="center">AFH</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">ACH</td>
<td align="center">ABH</td>
<td align="center">AAH</td>
<td align="center">A9H</td>
<td align="center">A8H</td>
</tr>
</tbody></table>
<h4 id="中断优先级寄存器-IP"><a href="#中断优先级寄存器-IP" class="headerlink" title="中断优先级寄存器 IP"></a>中断优先级寄存器 IP</h4><table>
<thead>
<tr>
<th align="center">位序</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="center">名称</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>PS</td>
<td>PT1</td>
<td>PX1</td>
<td>PT0</td>
<td>PX0</td>
</tr>
<tr>
<td align="center">优先级控制位（0低，1高）</td>
<td></td>
<td></td>
<td></td>
<td>串口</td>
<td>定时器1</td>
<td>外部中断1</td>
<td>定时器0</td>
<td>外部中断0</td>
</tr>
<tr>
<td align="center">位地址</td>
<td></td>
<td></td>
<td></td>
<td>BCH</td>
<td>BBH</td>
<td>BAH</td>
<td>B9H</td>
<td>B8H</td>
</tr>
</tbody></table>
<h4 id="定时-计数器的控制寄存器-TCON"><a href="#定时-计数器的控制寄存器-TCON" class="headerlink" title="定时&#x2F;计数器的控制寄存器 TCON"></a>定时&#x2F;计数器的控制寄存器 TCON</h4><table>
<thead>
<tr>
<th align="center">位序</th>
<th align="center">7</th>
<th align="center">6</th>
<th align="center">5</th>
<th align="center">4</th>
<th align="center">3</th>
<th align="center">2</th>
<th align="center">1</th>
<th align="center">0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">位名称</td>
<td align="center">TF1</td>
<td align="center">TR1</td>
<td align="center">TF0</td>
<td align="center">TR0</td>
<td align="center">IE0</td>
<td align="center">IT1</td>
<td align="center">IE0</td>
<td align="center">IT0</td>
</tr>
</tbody></table>
<ul>
<li><strong>TF1</strong>：定时&#x2F;计数器T1溢出中断请求位（0：无中断请求，1：有中断请求）</li>
<li><strong>TR1</strong>：定时&#x2F;计数器T1启动位（0：停止定时&#x2F;计数器，1：启动定时&#x2F;计数器）</li>
<li><strong>TF0</strong>：定时&#x2F;计数器T0溢出中断请求位</li>
<li><strong>TR0</strong>：定时&#x2F;计数器T0启动位</li>
<li><strong>IE1</strong>：外部中断1请求标志位</li>
<li><strong>IT1</strong>：外部中断1触发方式控制位（0：低电平触发，1：下降沿触发）</li>
<li><strong>IE0</strong>：外部中断0请求标志位</li>
<li><strong>IT0</strong>：外部中断0触发方式控制位（0：低电平触发，1：下降沿触发）</li>
</ul>
<p><strong>下降沿</strong>：</p>
<blockquote>
<p> 电平从高电平（数字“1”）变为低电平（数字“0”）的那一瞬间叫作下降沿。 </p>
</blockquote>
<h4 id="串行口控制寄存器-SCON"><a href="#串行口控制寄存器-SCON" class="headerlink" title="串行口控制寄存器 SCON"></a>串行口控制寄存器 SCON</h4><table>
<thead>
<tr>
<th align="center">位序</th>
<th align="center">7</th>
<th align="center">6</th>
<th align="center">5</th>
<th align="center">4</th>
<th align="center">3</th>
<th align="center">2</th>
<th align="center">1</th>
<th align="center">0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">位名称</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">TI</td>
<td align="center">RI</td>
</tr>
</tbody></table>
<ul>
<li><strong>TI</strong>：串行接口发送完成中断请求标志位（ 响应中断时需手动软件清除）</li>
<li><strong>RI</strong>：串行接口接收完成中断请求标志位（ 响应中断时需手动软件清除）</li>
</ul>
<h3 id="一次中断的完整步骤"><a href="#一次中断的完整步骤" class="headerlink" title="一次中断的完整步骤"></a>一次中断的完整步骤</h3><ol>
<li><p>中断请求</p>
<p>中断事件一旦发生，中断源提交中断请求（将中断标志位置为1），欲请求CPU暂停目前的工作，转向为该中断作专项服务；</p>
</li>
<li><p>中断使能</p>
<p>虽然中断源提交了中断请求，但是能否得到CPU的响应，还要取决于该中断请求能否通过若干的关卡送达CPU（中断使能位为1，关卡放行），关卡有两类：</p>
<ul>
<li>此中断源的中断允许位</li>
<li>全局中断允许位</li>
</ul>
</li>
<li><p>中断响应</p>
<p>如果一路通畅，则CPU响应该中断请求，记录断点，跳转到中断服务程序。对于INT和TMR中断，中断响应时中断标志位会被硬件自动清零。</p>
</li>
<li><p>中断处理</p>
<p>对中断源进行有针对性的服务；</p>
</li>
<li><p>中断返回</p>
<p>返回到主程序断点处，继续执行主程序；</p>
</li>
</ol>
<p>1，3，5由硬件自动完成，2，4由用户编程完成。中断响应条件为1，2同时满足。</p>
<h2 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> i ,j;</span><br><span class="line">	<span class="keyword">for</span>(i = ms; i &gt; <span class="number">0</span>; i--)&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">112</span>; j&gt;<span class="number">0</span>; j--);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	P1 =   <span class="number">0x0f</span>;	<span class="comment">//0000 1111</span></span><br><span class="line">	EX1 = <span class="number">1</span>;	    <span class="comment">//外部中断1 INT1 打开</span></span><br><span class="line">	EA =<span class="number">1</span>;		    <span class="comment">//全局中断打开</span></span><br><span class="line">	IT1 = <span class="number">1</span>;		<span class="comment">//设置触发方式为下降沿触发</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中断服务函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">low</span><span class="params">()</span> interrupt 2&#123;</span><br><span class="line">	P1 = ~P1;</span><br><span class="line">	Delay(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先设置P1管脚连接的排灯为后四个灯亮，把各个卡点开启（如外部中断1 和 全局中断），IT1（P3.3）设置触发方式为下降沿，之后可以将引脚P3.3与P3.6（按键）连接，如此一来就可以通过按键来触发中断；</p>
<p>当按键按下松手时即是一个下降沿，此时会触发中断，执行中断服务函数，转变为前四个灯亮。</p>
</article><div id="paginator"></div></main><footer><div class="icon-wrapper in-left"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span></button></div><div class="icon-wrapper in-right"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></span></button></div><p class="copyright-text"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer">CC BY-NC-SA 4.0</a><span>·</span><a href="https://github.com/ttttonyhe/ouorz-mono" target="_blank" rel="noreferrer">Open Source Software (OSS)</a></p></footer><script src="/js/ouo.js"></script></div></body></html>