<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>【文章翻译】使用文本编辑器手工制作电子书 [ Mahoo12138 ]</title><link rel="stylesheet" href="/css/index.css"><meta name="post"><link rel="stylesheet" href="/css/layouts/post.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="hexo-container"><header></header><main id="content"><article id="post"><h1>【文章翻译】使用文本编辑器手工制作电子书</h1><p>没有什么比装订好的 EPUB 格式的电子书更能抚慰人的心灵了。</p>
<p>接下来是我的夜晚的旅程，是为了搞清楚为什么使用 pandoc 生成的 epub 文件无法上传到 Google Books。内容是一篇维基百科的文章。</p>
<p>我联系了谷歌支持（我对任何存在的支持都印象深刻），他们提供了愉快的帮助。默认情况下，我被定向到了“合作伙伴计划”支持。推测可能是，因为我注册只是为了看它，甚至不是使用它，这意味着他们可能得到优先级，这也就能解释我的良好体验了！</p>
<p>Barish 引导我至<a target="_blank" rel="noopener" href="https://github.com/w3c/epubcheck">EPUB 验证器</a>接着告诉我，我有任何东西需要报告的话可以与其他团队联系。</p>
<p>所以我查阅了“EPUB 规范”，并决定最好的起点是这个容器的格式。结果显示，EPUB 仅仅只是 zip 归档格式。 此时，我开始在其它三个文件中搜索关键词“require”，很快我就了解了最低的要求。令人印象深刻的是，使用这个关键词搜索产生了大量信息，我开始手工制作。</p>
<h2 id="手工制作-EPUB"><a href="#手工制作-EPUB" class="headerlink" title="手工制作 EPUB"></a>手工制作 EPUB</h2><p>定义一个 EPUB 文件仅需要4个文件即可。</p>
<p>以下是文件内容的副本，用于直观地展示一个最小的，严格有效的EPUB文件，能让读者看到 ids 和文件是如何联系在一起的。</p>
<p>mimetype：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application/epub+zip</span><br></pre></td></tr></table></figure>

<p>META-INF&#x2F;container.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">container</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:oasis:names:tc:opendocument:xmlns:container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rootfiles</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rootfile</span> <span class="attr">full-path</span>=<span class="string">&quot;content.opf&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;application/oebps-package+xml&quot;</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">   <span class="tag">&lt;/<span class="name">rootfiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>EPUB&#x2F;index.opf：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span> <span class="attr">unique-identifier</span>=<span class="string">&quot;myId&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.idpf.org/2007/opf&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">metadata</span> <span class="attr">xmlns:dc</span>=<span class="string">&quot;http://purl.org/dc/elements/1.1/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dc:identifier</span> <span class="attr">id</span>=<span class="string">&quot;myId&quot;</span>&gt;</span>urn:uuid:A1B0D67E-2E81-4DF5-9E67-A64CBE366809<span class="tag">&lt;/<span class="name">dc:identifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dc:title</span>&gt;</span>Handmade<span class="tag">&lt;/<span class="name">dc:title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dc:language</span>&gt;</span>en<span class="tag">&lt;/<span class="name">dc:language</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">property</span>=<span class="string">&quot;dcterms:modified&quot;</span>&gt;</span>2011-01-01T12:00:00Z<span class="tag">&lt;/<span class="name">meta</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">metadata</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">id</span>=<span class="string">&quot;nav&quot;</span> <span class="attr">href</span>=<span class="string">&quot;nav.xhtml&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;application/xhtml+xml&quot;</span> <span class="attr">properties</span>=<span class="string">&quot;nav&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">spine</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemref</span> <span class="attr">idref</span>=<span class="string">&quot;nav&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">spine</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>EPUB&#x2F;nav.xhtml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="attr">xmlns:epub</span>=<span class="string">&quot;http://www.idpf.org/2007/ops&quot;</span> <span class="attr">xml:lang</span>=<span class="string">&quot;en-CA&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>0<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">epub:type</span>=<span class="string">&quot;toc&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Must be text<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于这个新的最小的EPUB文件，我将其上传到 Google Books，没有问题，它被接受了！拥有我自己的控制的EPUB，我现在能开始进一步缩减它的大小了。这涉及到近一小时的移除构件和许多许多次的重载；我不打算将这些编辑包含进去，仅是因为它们会随时间而改变，很快变得没用。Google Books 是确定没有使用最严格的 epubcheck  规则的，或是根本没有使用 epubcheck 。他们作为 epubcheck  的大赞助商，所以这也是需要考虑的。</p>
<p>这些文件现在能作为基础，以简单地创建书籍，并上传或在设备上阅读。</p>
<h2 id="编译书籍"><a href="#编译书籍" class="headerlink" title="编译书籍"></a>编译书籍</h2><p>mimetype 文件必须是归档文件中地第一个，特别的是不要带上“压缩额外字段”，所以你的压缩命令将看起来像这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip -X -r Handmade.epub mimetype *</span><br><span class="line"><span class="comment"># -X 即是不带额外字段</span></span><br></pre></td></tr></table></figure>

<p>当压缩时，要确保没有 “前缀 “目录（原来存放文件的目录名称）。</p>
<h2 id="向书籍添加内容"><a href="#向书籍添加内容" class="headerlink" title="向书籍添加内容"></a>向书籍添加内容</h2><p>书籍的内容必须是XML格式。维基百科有许多精彩的内容，但是维基文本需要被转换。下载 php，composer，并下载 parsoid 项目。使用<code>composer install</code>安装 parsoid 项目依赖，我们使用它将维基文本转换为 XML 格式。</p>
<p>现在你能使用这个转换器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> | php bin/parser.php</span><br></pre></td></tr></table></figure>

<p>之后，你将得到 HTML&#x2F;XML 格式的输出。</p>
<p><code>https://en.wikipedia.org/wiki/MYPAGE?action=raw</code>使用这个链接可以获取到任何的维基百科页面的维基文本。将其与一个小脚本结合起来，用合适的标记来包装它，任何文章都可以很容易地变成一本书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PAGE=&quot;Hedonism&quot;</span><br><span class="line">echo &#x27;&lt;html&gt;&lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&#x27; &gt; out.xml \</span><br><span class="line">&amp;&amp; curl &quot;https://en.wikipedia.org/wiki/$PAGE?action=raw&quot;  \</span><br><span class="line">|  php bin/parser.php &gt;&gt; out.xhtml                        \</span><br><span class="line">&amp;&amp; echo &#x27;&lt;/body&gt;&lt;/html&gt;&#x27; &gt;&gt; out.xhtml</span><br></pre></td></tr></table></figure>

<p>不幸的是，这并不能纠正引用不存在的问题。无论是自动还是手动，所有图片和外部资源的链接都将需要被删除。使用 <code>sed </code>命令可以完成这大部分的工作，但应该使用合适的 HTML&#x2F;XML<br>解析器来删除有问题的数据。</p>
<p>在打开 <em>EPUB&#x2F;index.opf</em>后，将新条目添加到 <strong>manifest</strong> 和 <strong>spine</strong> 元素中。运行<code>zip</code>来创建EPUB并上传。</p>
<p>你现在可以阅读维基百科的文章，并在任何运行 Google Books 的设备上继续阅读你离开的地方。</p>
<h2 id="最后的感想"><a href="#最后的感想" class="headerlink" title="最后的感想"></a>最后的感想</h2><ol>
<li>如果能有一个插件能自动完成这个过程那就太棒了。</li>
<li>我想知道 Google Books 的引擎在查看外部参考资料时做了什么。潜在的安全漏洞？</li>
<li>编写一个基本的程序来获取维基百科的 URL 并输出 EPUB，对任何想真正使用它的人（比如我）来说，应该是微不足道的。</li>
<li>EPUB实际上是一个相当不错的格式，如果你忽略了它的所有XML。</li>
</ol>
</article><div id="paginator"></div></main><footer><div class="icon-wrapper in-left"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span></button></div><div class="icon-wrapper in-right"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></span></button></div><p class="copyright-text"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer">CC BY-NC-SA 4.0</a><span>·</span><a href="https://github.com/ttttonyhe/ouorz-mono" target="_blank" rel="noreferrer">Open Source Software (OSS)</a></p></footer><script src="/js/ouo.js"></script></div></body></html>