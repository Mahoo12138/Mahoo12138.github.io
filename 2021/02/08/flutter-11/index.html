<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Flutter 入门学习之矩阵变换 [ Mahoo12138 ]</title><link rel="stylesheet" href="/css/index.css"><meta name="post"><link rel="stylesheet" href="/css/layouts/post.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="hexo-container"><header></header><main id="content"><article id="post"><h1>Flutter 入门学习之矩阵变换</h1><h2 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h2><blockquote>
<p>在绘制子控件之前，为其添加矩阵变换的小部件。</p>
</blockquote>
<p>但需要注意的是，矩阵变换不像 <strong>RotatedBox</strong>（在布局前进行变换），而是在绘制前进行变换，也就是说子控件虽然进行了变换，但是其布局无变化，意味着子控件的位置和大小都没有随着进行变化。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Transform(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.transform,</span><br><span class="line">    <span class="keyword">this</span>.origin,</span><br><span class="line">    <span class="keyword">this</span>.alignment,</span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="keyword">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>transform</code>：变换的过程中的矩阵 <strong>Matrix4</strong></li>
<li><code>origin</code>：子组件作变换的原点，是以左上角的为坐标原点设置的点</li>
<li><code>alignment</code>：子组件原点的对齐方式，也就是改变坐标的原点的位置</li>
<li><code>transformHitTests</code>：点击区域时是否变换</li>
</ul>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对子组件旋转45°</span></span><br><span class="line">Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">&quot;Transform Demo Page&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: Center(</span><br><span class="line">        child: Container(</span><br><span class="line">            width: <span class="number">200</span>,</span><br><span class="line">            height: <span class="number">100</span>,</span><br><span class="line">            color: Colors.grey.shade600,</span><br><span class="line">            child: Transform(</span><br><span class="line">                origin: Offset(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">                alignment: Alignment.topRight,</span><br><span class="line">                transform: Matrix4.rotationZ(<span class="number">0.785</span>),</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.amber,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/mahoo12138/js-css-cdn/hexo-images/20210209230846.jpg"></p>
<p><strong>Transform</strong> 有多个不同的命名构造函数，分别对应这不同的变换效果：</p>
<h3 id="Transform-scale-缩放"><a href="#Transform-scale-缩放" class="headerlink" title="Transform.scale 缩放"></a>Transform.scale 缩放</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.scale(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="meta">@required</span> <span class="built_in">double</span> scale,     <span class="comment">// 缩放比例</span></span><br><span class="line">    <span class="keyword">this</span>.origin,    			</span><br><span class="line">    <span class="keyword">this</span>.alignment = Alignment.center, </span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="keyword">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.diagonal3Values(scale, scale, <span class="number">1.0</span>),</span><br><span class="line">    <span class="keyword">super</span>(key: key, child: child);</span><br></pre></td></tr></table></figure>

<p>从上述代码中可看出，需要注意：</p>
<ul>
<li>缩放是通过传入缩放比例到<code>Matrix4.diagonal3Values(scale, scale, 1.0)</code>，只是缩放 x 轴和 y 轴，z 轴无变化，当然 z 轴的变化也无从感知；</li>
<li>原点的对齐方式是默认居中的，也就是放大后的组件，是与原组件是同中心的。</li>
</ul>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">        backgroundColor: Colors.pink.shade400,</span><br><span class="line">        title: Text(<span class="string">&quot;Transform Demo Page&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">            children: [</span><br><span class="line">                Container(</span><br><span class="line">                    alignment: Alignment.center,</span><br><span class="line">                    width: <span class="number">200</span>,</span><br><span class="line">                    height:<span class="number">200</span>,</span><br><span class="line">                    color: Colors.blue,</span><br><span class="line">                    child: Container(</span><br><span class="line">                        color: <span class="keyword">const</span> Color(<span class="number">0xFFE8581C</span>),</span><br><span class="line">                        child: <span class="keyword">const</span> Text(<span class="string">&#x27;你好，我未缩放&#x27;</span>),</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">                SizedBox.fromSize(size: Size(<span class="built_in">double</span>.infinity,<span class="number">50</span>),),</span><br><span class="line">                Container(</span><br><span class="line">                    alignment: Alignment.center,</span><br><span class="line">                    width: <span class="number">200</span>,</span><br><span class="line">                    height: <span class="number">200</span>,</span><br><span class="line">                    color: Colors.blue,</span><br><span class="line">                    child:  Transform.scale(</span><br><span class="line">                        origin: Offset(<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">                        alignment: Alignment.topRight,</span><br><span class="line">                        scale: <span class="number">1.5</span>,</span><br><span class="line">                        child: Container(</span><br><span class="line">                            color: <span class="keyword">const</span> Color(<span class="number">0xFFE8581C</span>),</span><br><span class="line">                            child: <span class="keyword">const</span> Text(<span class="string">&#x27;你好，我已缩放&#x27;</span>),</span><br><span class="line">                        ),</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/mahoo12138/js-css-cdn/hexo-images/20210211110346.png"></p>
<h3 id="Transform-rotate-旋转"><a href="#Transform-rotate-旋转" class="headerlink" title="Transform.rotate 旋转"></a>Transform.rotate 旋转</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.rotate(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="meta">@required</span> <span class="built_in">double</span> angle,     <span class="comment">// 旋转角度</span></span><br><span class="line">    <span class="keyword">this</span>.origin,</span><br><span class="line">    <span class="keyword">this</span>.alignment = Alignment.center,</span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="keyword">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.rotationZ(angle),</span><br><span class="line">       <span class="keyword">super</span>(key: key, child: child);</span><br></pre></td></tr></table></figure>

<h3 id="Transform-translate-平移"><a href="#Transform-translate-平移" class="headerlink" title="Transform.translate 平移"></a>Transform.translate 平移</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.translate(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="meta">@required</span> Offset offset,		<span class="comment">// 平移坐标量</span></span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="keyword">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.translationValues(offset.dx, offset.dy, <span class="number">0.0</span>),</span><br><span class="line">       origin = <span class="keyword">null</span>,</span><br><span class="line">       alignment = <span class="keyword">null</span>,</span><br><span class="line">       <span class="keyword">super</span>(key: key, child: child);</span><br></pre></td></tr></table></figure>

<h3 id="skew-斜切"><a href="#skew-斜切" class="headerlink" title="skew 斜切"></a>skew 斜切</h3><p>斜切是个例外，<strong>Transform</strong> 类中没有给出封装的构造函数，只能用 <strong>Matrix4</strong> 传入 <strong>transform</strong>实现，以下是是个大小相同的 <strong>Container</strong> 的各式斜切：</p>
<h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">        backgroundColor: Colors.pink.shade400,</span><br><span class="line">        title: Text(<span class="string">&quot;Transform Demo Page&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">            children: [</span><br><span class="line">                Center(</span><br><span class="line">                    child: Transform(</span><br><span class="line">                        transform: Matrix4.skewY(pi / <span class="number">4</span>),</span><br><span class="line">                        alignment: Alignment.topLeft,</span><br><span class="line">                        child: Container(</span><br><span class="line">                            width: <span class="number">120.0</span>, height: <span class="number">80.0</span>, color: Colors.brown))),</span><br><span class="line">                Center(</span><br><span class="line">                    child: Transform(</span><br><span class="line">                        transform: Matrix4.skewX(pi / <span class="number">4</span>),</span><br><span class="line">                        alignment: Alignment.topLeft,</span><br><span class="line">                        child: Container(</span><br><span class="line">                            width: <span class="number">120.0</span>, height: <span class="number">80.0</span>, color: Colors.redAccent))),</span><br><span class="line">                Center(</span><br><span class="line">                    child: Transform(</span><br><span class="line">                        transform: Matrix4.skew(pi / <span class="number">6</span>, pi / <span class="number">6</span>),</span><br><span class="line">                        alignment: Alignment.topLeft,</span><br><span class="line">                        child: Container(</span><br><span class="line">                            width: <span class="number">120.0</span>, height: <span class="number">80.0</span>, color: Colors.amber))),</span><br><span class="line">                Center(</span><br><span class="line">                    child: Transform(</span><br><span class="line">                        transform: Matrix4.skew(<span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">                        alignment: Alignment.topLeft,</span><br><span class="line">                        child: Container(</span><br><span class="line">                            width: <span class="number">120.0</span>, height: <span class="number">80.0</span>, color: Colors.blue))),</span><br><span class="line">            ],</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</article><div id="paginator"></div></main><footer><div class="icon-wrapper in-left"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span></button></div><div class="icon-wrapper in-right"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></span></button></div><p class="copyright-text"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer">CC BY-NC-SA 4.0</a><span>·</span><a href="https://github.com/ttttonyhe/ouorz-mono" target="_blank" rel="noreferrer">Open Source Software (OSS)</a></p></footer><script src="/js/ouo.js"></script></div></body></html>